{% extends "base.html" %}

{% block title %}Report Issue - CivicFix{% endblock %}

{% block head %}
<link rel="stylesheet"
    href="{{ url_for('static', filename='css/add_problem.css') }}">
<!-- Leaflet (needed globally if map JS runs conditionally) -->
<link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block container %}
<div class="form-card" data-aos="fade-up">
    <h2>Report a New Problem</h2>

    <form action="/submit" method="POST" enctype="multipart/form-data">
        <label>Category <span style="color: #ff4d4d;">*</span></label>
        <select name="category" required>
            <option value>-- Select Category --</option>
            <option value="Road / Pothole">Road / Pothole</option>
            <option value="Garbage">Garbage</option>
            <option value="Water">Water Supply</option>
            <option value="Drainage">Drainage</option>
            <option value="Electricity">Electricity / Street Light</option>
            <option value="Public Safety">Public Safety</option>
            <option value="Other">Other</option>
        </select>

        <label>Description <span style="color: #ff4d4d;">*</span></label>
        <textarea name="description" placeholder="Describe the issue..."
            required></textarea>

        <label>Upload Evidence (Photo)</label>
        <input type="file" name="image" id="imageInput" accept="image/*">

        <div id="ml-feedback" class="hidden">Analyzing image with AI...</div>

        <label>Select Location on Map <span style="color: #ff4d4d;">*</span></label>
        <label style="font-size: small;">Search Location</label>
        <input
            type="text"
            id="location-search"
            placeholder="Search area, landmark, city...">

        <div id="map" style="height: 300px; margin-bottom: 10px;"
            data-aos="fade-up" data-aos-delay="200" data-aos-once="true"></div>

        <!-- Hidden fields for backend -->
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">
        <input type="hidden" name="area_name" id="area-name-input">

        <small>Click on the map to mark the exact location</small>

        <div id="location-info" class="location-info">
            <strong>Selected Location:</strong>
            <span id="coords-text">Not selected</span>
        </div>

        <div id="area-name" class="area-name"></div>
        <button type="submit" class="btn-submit">Post Problem</button>

    </form>
</div>
<div id="toast-container"></div>
{% block scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/add_problem.js') }}"></script>
{% endblock %}

{% endblock %}